## 一、项目背景
整合市面上所流行的第三方支付渠道，方便了商户和用户的使用，我们不进行资金清算

## 二、平台的三个模块
平台主要包括三个模块：官网&开放平台、商户平台、运营平台

## 三、技术栈
业务数据持久化采用MySQL，数据缓存采用Redis，
采用RocketMQ的事务消息机制完成部分场景下的分布式事务控制，采用第三方云平台完成文件上传与分布式存储。
系统微服务基于SpringBoot开发，数据库连接池采用Druid，POJO构建采用Lombok，日志系统采用Log4j2，
Guava工具类库，Mybatis Plus持久层接口实现，Sharding-jdbc分库分表组件，Swagger接口规范组件，XXL-job
分布式任务调度组件，Sentinel限流组件等 Nacos discovery Nacos Config Zxing
Zuul网关完成客户端认证、路由转发等功能，Dubbo RPC完成微服务远程调用，JWT提供前后端令牌管理方案。

## 四、商户如何使用
商户进行注册，注册之后进行登录，资质申请，运营平台审核，创建应用，绑定服务类型
（支付场景：线上和线下b2c和c2b）
会向商户展示第三方支付的渠道列表，用户选择支付渠道进行配置
b2c--进入到应用的门店列表，生成门店的二维码，运营团队为商户制作二维码

## 五、负责了哪些功能

#### 1. 商户注册

前端请求商户平台应用进行注册，商户平台应用获取SaaS短信服务短信验证码
前端携带手机验证码、账号、密码等信息请求商户平台验证码服务确认注册
验证码在商户平台应用校验通过后请求商户服务新增商户
SaaS平台返回创建成功给商户服务，商户服务新增商户下根门店信息

#### 2. 资质申请 -- 阿里云的OSS对象存储
商户填写资质信息
上传营业执照和法人身份证图片 这边对接了阿里云的OSS对象存储
提交资质信息
平台运营人员对商户资质信息进行审核
审核通过后，完成资质申请

对接阿里云对象存储，上传文件

#### 3. 参数配置 -- 缓存（配置：添加、修改）

应用和服务类型有个中间表，支付参数表中包含了中间表的id和支付渠道code，这样可以
通过支付渠道code、服务类型code和appid来查询出商户中的应用对应的支付渠道参数

#### 4. 二维码的生成
包含了支付入口的url，用户扫二维码会直接跳转到支付入口，用户进行支付
二维码中还包含 门店id、应用id、商户id、服务类型code

#### 5. 支付入口用户在支付的时候我们会根据请求头的User-Agent判断用户使用什么支付渠道，
通过应用id、服务类型code、支付渠道code获取支付参数

#### 6. 生成订单 获取支付参数进行支付 使用rocketmq发送延迟消息查询支付状态，rocketmq消费者通过
状态判断，如果是正在支付中，进行消息重试，当查询出用户交易完成、交易关闭、修改订单状态
